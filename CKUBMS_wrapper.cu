
// error checking macro
#define cudaCheckErrors(msg)                                                   \
  do {                                                                         \
    cudaError_t __err = cudaGetLastError();                                    \
    if (__err != cudaSuccess) {                                                \
      fprintf(stderr, "Fatal error: %s (%s at %s:%d)\n", msg,                  \
              cudaGetErrorString(__err), __FILE__, __LINE__);                  \
      fprintf(stderr, "*** FAILED - ABORTING\n");                              \
      exit(1);                                                                 \
    }                                                                          \
  } while (0)

// Problem parameters
const size_t NUM_SPECIES = 53;
const double T_MIN = 297.99515;             // based on simulation log
const double T_MAX = 1891.6578;             // based on simulation log
const double MASSFRAC_MIN = -0.00015890965; // based on simulation log
const double MASSFRAC_MAX = 0.73261661;     // based on simulation log
const size_t NUM_CELLS = 3145728;
const size_t MAX_ITERS = 5000;

const size_t BLOCK_SIZE = 256;

//
__device__ __forceinline__ void
CKUBMS(const double T, const double y[NUM_SPECIES], double &ubms) {
  double result = 0.0;
  const double T2 = T * T;
  const double T3 = T * T * T;
  const double T4 = T * T * T * T;
  const double invT = 1.0 / T;

  // species with midpoint at T=1000 kelvin
  if (T < 1000) {
    // species 1: H
    result +=
        y[1] *
        (+1.50000000e+00 + 3.52666409e-13 * T - 6.65306547e-16 * T2 +
         5.75204080e-19 * T3 - 1.85546466e-22 * T4 + 2.54736599e+04 * invT) *
        0.9920634920634921;
    // species 2: O
    result +=
        y[2] *
        (+2.16826710e+00 - 1.63965942e-03 * T + 2.21435465e-06 * T2 -
         1.53201656e-09 * T3 + 4.22531942e-13 * T4 + 2.91222592e+04 * invT) *
        0.0625039064941559;
    // species 3: OH
    result +=
        y[3] *
        (+3.12530561e+00 - 1.61272470e-03 * T + 2.17588230e-06 * T2 -
         1.44963411e-09 * T3 + 4.12474758e-13 * T4 + 3.38153812e+03 * invT) *
        0.0587993179279120;
    // species 4: HO2
    result +=
        y[4] *
        (+3.30179801e+00 - 2.37456025e-03 * T + 7.05276303e-06 * T2 -
         6.06909735e-09 * T3 + 1.85845025e-12 * T4 + 2.94808040e+02 * invT) *
        0.0302975216627280;
    // species 5: H2
    result +=
        y[5] *
        (+1.34433112e+00 + 3.99026037e-03 * T - 6.49271700e-06 * T2 +
         5.03930235e-09 * T3 - 1.47522352e-12 * T4 - 9.17935173e+02 * invT) *
        0.4960317460317460;
    // species 6: H2O
    result +=
        y[6] *
        (+3.19864056e+00 - 1.01821705e-03 * T + 2.17346737e-06 * T2 -
         1.37199266e-09 * T3 + 3.54395634e-13 * T4 - 3.02937267e+04 * invT) *
        0.0555092978073827;
    // species 7: H2O2
    result +=
        y[7] *
        (+3.27611269e+00 - 2.71411208e-04 * T + 5.57785670e-06 * T2 -
         5.39427032e-09 * T3 + 1.72490873e-12 * T4 - 1.77025821e+04 * invT) *
        0.0293996589639560;
    // species 8: O2
    result +=
        y[8] *
        (+2.78245636e+00 - 1.49836708e-03 * T + 3.28243400e-06 * T2 -
         2.42032377e-09 * T3 + 6.48745674e-13 * T4 - 1.06394356e+03 * invT) *
        0.0312519532470779;
    // species 9: CH2
    result +=
        y[9] *
        (+2.76267867e+00 + 4.84436072e-04 * T + 9.31632803e-07 * T2 -
         9.62727883e-10 * T3 + 3.37483438e-13 * T4 + 4.60040401e+04 * invT) *
        0.0712910814857061;
    // species 10: CH2*
    result +=
        y[10] *
        (+3.19860411e+00 - 1.18330710e-03 * T + 2.74432073e-06 * T2 -
         1.67203995e-09 * T3 + 3.88629474e-13 * T4 + 5.04968163e+04 * invT) *
        0.0712910814857061;
    // species 11: CH3
    result +=
        y[11] *
        (+2.67359040e+00 + 1.00547588e-03 * T + 1.91007285e-06 * T2 -
         1.71779356e-09 * T3 + 5.08771468e-13 * T4 + 1.64449988e+04 * invT) *
        0.0665114732291320;
    // species 12: CH4
    result +=
        y[12] *
        (+4.14987613e+00 - 6.83548940e-03 * T + 1.63933533e-05 * T2 -
         1.21185757e-08 * T3 + 3.33387912e-12 * T4 - 1.02466476e+04 * invT) *
        0.0623324814560868;
    // species 13: HCO
    result +=
        y[13] *
        (+3.22118584e+00 - 1.62196266e-03 * T + 4.59331487e-06 * T2 -
         3.32860233e-09 * T3 + 8.67537730e-13 * T4 + 3.83956496e+03 * invT) *
        0.0344613688055690;
    // species 14: CH2O
    result +=
        y[14] *
        (+3.79372315e+00 - 4.95416684e-03 * T + 1.24406669e-05 * T2 -
         9.48213152e-09 * T3 + 2.63545304e-12 * T4 - 1.43089567e+04 * invT) *
        0.0333044694598015;
    // species 15: CH3O
    result +=
        y[15] *
        (+2.71180502e+00 - 1.40231653e-03 * T + 1.25516990e-05 * T2 -
         1.18268022e-08 * T3 + 3.73176840e-12 * T4 + 1.29569760e+03 * invT) *
        0.0322227234645872;
    // species 16: CO
    result +=
        y[16] *
        (+2.57953347e+00 - 3.05176840e-04 * T + 3.38938110e-07 * T2 +
         2.26751471e-10 * T3 - 1.80884900e-13 * T4 - 1.43440860e+04 * invT) *
        0.0357015351660121;
    // species 17: CO2
    result +=
        y[17] *
        (+1.35677352e+00 + 4.49229839e-03 * T - 2.37452090e-06 * T2 +
         6.14797555e-10 * T3 - 2.87399096e-14 * T4 - 4.83719697e+04 * invT) *
        0.0227226249176305;
    // species 18: C2H2
    result +=
        y[18] *
        (-1.91318906e-01 + 1.16807815e-02 * T - 1.18390605e-05 * T2 +
         7.00381092e-09 * T3 - 1.70014595e-12 * T4 + 2.64289807e+04 * invT) *
        0.0384054074813734;
    // species 19: C2H3
    result +=
        y[19] *
        (+2.21246645e+00 + 7.57395810e-04 * T + 8.64031373e-06 * T2 -
         8.94144617e-09 * T3 + 2.94301746e-12 * T4 + 3.48598468e+04 * invT) *
        0.0369740442209569;
    // species 20: C2H4
    result +=
        y[20] *
        (+2.95920148e+00 - 3.78526124e-03 * T + 1.90330097e-05 * T2 -
         1.72897188e-08 * T3 + 5.39768746e-12 * T4 + 5.08977593e+03 * invT) *
        0.0356455407428531;
    // species 21: C2H5
    result +=
        y[21] *
        (+3.30646568e+00 - 2.09329446e-03 * T + 1.65714269e-05 * T2 -
         1.49781651e-08 * T3 + 4.61018008e-12 * T4 + 1.28416265e+04 * invT) *
        0.0344091941366733;
    // species 22: C2H6
    result +=
        y[22] *
        (+3.29142492e+00 - 2.75077135e-03 * T + 1.99812763e-05 * T2 -
         1.77116571e-08 * T3 + 5.37371542e-12 * T4 - 1.15222055e+04 * invT) *
        0.0332557366145660;
    // species 23: CH2CHO
    result +=
        y[23] *
        (+2.40906240e+00 + 5.36928700e-03 * T + 6.30497500e-07 * T2 -
         1.78964578e-09 * T3 + 5.73477020e-13 * T4 + 6.20000000e+01 * invT) *
        0.0232315019165989;
    // species 24: aC3H5
    result +=
        y[24] *
        (+3.63183500e-01 + 9.90691050e-03 * T + 4.16568667e-06 * T2 -
         8.33888875e-09 * T3 + 3.16931420e-12 * T4 + 1.92456290e+04 * invT) *
        0.0243468945535997;
    // species 25: C3H6
    result +=
        y[25] *
        (+4.93307000e-01 + 1.04625900e-02 * T + 1.49559800e-06 * T2 -
         4.17228000e-09 * T3 + 1.43162920e-12 * T4 + 1.07482600e+03 * invT) *
        0.0237636938285687;
    // species 26: nC3H7
    result +=
        y[26] *
        (+4.91173000e-02 + 1.30044865e-02 * T + 7.84750533e-07 * T2 -
         4.89878300e-09 * T3 + 1.87440414e-12 * T4 + 1.03123460e+04 * invT) *
        0.0232077792476038;
    // species 27: C2H3CHO
    result +=
        y[27] *
        (+2.71349800e-01 + 1.31155270e-02 * T - 3.09707683e-06 * T2 -
         1.19593180e-09 * T3 + 6.69610860e-13 * T4 - 9.33573440e+03 * invT) *
        0.0178367579908676;
    // species 28: C4H7
    result +=
        y[28] *
        (-2.55505680e-01 + 1.98394285e-02 * T - 7.63269533e-06 * T2 +
         5.33824325e-10 * T3 + 4.61927500e-13 * T4 + 2.26533280e+04 * invT) *
        0.0181488203266788;
    // species 29: C4H81
    result +=
        y[29] *
        (+1.81138000e-01 + 1.54266900e-02 * T + 1.69550823e-06 * T2 -
         6.16372200e-09 * T3 + 2.22203860e-12 * T4 - 1.79040040e+03 * invT) *
        0.0178227703714265;
    // species 30: pC4H9
    result +=
        y[30] *
        (+2.08704200e-01 + 1.91487485e-02 * T - 2.42201697e-06 * T2 -
         3.85713675e-09 * T3 + 1.73718870e-12 * T4 + 7.32210400e+03 * invT) *
        0.0175082288675678;
    // species 31: C5H9
    result +=
        y[31] *
        (-3.41901110e+00 + 2.02151945e-02 * T + 2.26007797e-06 * T2 -
         8.43118550e-09 * T3 + 3.02334260e-12 * T4 + 2.81218870e+03 * invT) *
        0.0144661275623128;
    // species 48: C12H25O2
    result +=
        y[48] *
        (+4.31404000e+00 + 4.46936500e-02 * T + 4.84503333e-06 * T2 -
         1.87312500e-08 * T3 + 6.70650000e-12 * T4 - 2.98918000e+04 * invT) *
        0.0049669696518154;
    // species 49: C12OOH
    result +=
        y[49] *
        (+4.15231000e+00 + 4.98956500e-02 * T - 6.02116667e-06 * T2 -
         1.04608750e-08 * T3 + 4.45572000e-12 * T4 - 2.38380000e+04 * invT) *
        0.0049669696518154;
    // species 50: O2C12H24OOH
    result +=
        y[50] *
        (-5.18028000e-01 + 7.25100000e-02 * T - 3.33102667e-05 * T2 +
         6.51055000e-09 * T3 + 2.38716000e-13 * T4 - 4.16875000e+04 * invT) *
        0.0042858122471371;
    // species 51: OC12H23OOH
    result +=
        y[51] *
        (+7.80733000e+00 + 3.25311500e-02 * T + 2.31686000e-05 * T2 -
         3.17262500e-08 * T3 + 1.02198200e-11 * T4 - 6.65361000e+04 * invT) *
        0.0046227596950828;
    // species 52: N2
    result +=
        y[52] *
        (+2.29867700e+00 + 7.04120200e-04 * T - 1.32107400e-06 * T2 +
         1.41037875e-09 * T3 - 4.88970800e-13 * T4 - 1.02089990e+03 * invT) *
        0.0356964374955379;
  } else {
    // species 1: H
    result +=
        y[1] *
        (+1.50000001e+00 - 1.15421486e-11 * T + 5.38539827e-15 * T2 -
         1.18378809e-18 * T3 + 9.96394714e-23 * T4 + 2.54736599e+04 * invT) *
        0.9920634920634921;
    // species 2: O
    result +=
        y[2] *
        (+1.56942078e+00 - 4.29870569e-05 * T + 1.39828196e-08 * T2 -
         2.50444497e-12 * T3 + 2.45667382e-16 * T4 + 2.92175791e+04 * invT) *
        0.0625039064941559;
    // species 3: OH
    result +=
        y[3] *
        (+1.86472886e+00 + 5.28252240e-04 * T - 8.63609193e-08 * T2 +
         7.63046685e-12 * T3 - 2.66391752e-16 * T4 + 3.71885774e+03 * invT) *
        0.0587993179279120;
    // species 4: HO2
    result +=
        y[4] *
        (+3.01721090e+00 + 1.11991006e-03 * T - 2.11219383e-07 * T2 +
         2.85615925e-11 * T3 - 2.15817070e-15 * T4 + 1.11856713e+02 * invT) *
        0.0302975216627280;
    // species 5: H2
    result +=
        y[5] *
        (+2.33727920e+00 - 2.47012365e-05 * T + 1.66485593e-07 * T2 -
         4.48915985e-11 * T3 + 4.00510752e-15 * T4 - 9.50158922e+02 * invT) *
        0.4960317460317460;
    // species 6: H2O
    result +=
        y[6] *
        (+2.03399249e+00 + 1.08845902e-03 * T - 5.46908393e-08 * T2 -
         2.42604967e-11 * T3 + 3.36401984e-15 * T4 - 3.00042971e+04 * invT) *
        0.0555092978073827;
    // species 7: H2O2
    result +=
        y[7] *
        (+3.16500285e+00 + 2.45415847e-03 * T - 6.33797417e-07 * T2 +
         9.27964965e-11 * T3 - 5.75816610e-15 * T4 - 1.78617877e+04 * invT) *
        0.0293996589639560;
    // species 8: O2
    result +=
        y[8] *
        (+2.28253784e+00 + 7.41543770e-04 * T - 2.52655556e-07 * T2 +
         5.23676387e-11 * T3 - 4.33435588e-15 * T4 - 1.08845772e+03 * invT) *
        0.0312519532470779;
    // species 9: CH2
    result +=
        y[9] *
        (+1.87410113e+00 + 1.82819646e-03 * T - 4.69648657e-07 * T2 +
         6.50448872e-11 * T3 - 3.75455134e-15 * T4 + 4.62636040e+04 * invT) *
        0.0712910814857061;
    // species 10: CH2*
    result +=
        y[10] *
        (+1.29203842e+00 + 2.32794318e-03 * T - 6.70639823e-07 * T2 +
         1.04476500e-10 * T3 - 6.79432730e-15 * T4 + 5.09259997e+04 * invT) *
        0.0712910814857061;
    // species 11: CH3
    result +=
        y[11] *
        (+1.28571772e+00 + 3.61995018e-03 * T - 9.95714493e-07 * T2 +
         1.48921161e-10 * T3 - 9.34308788e-15 * T4 + 1.67755843e+04 * invT) *
        0.0665114732291320;
    // species 12: CH4
    result +=
        y[12] *
        (-9.25148505e-01 + 6.69547335e-03 * T - 1.91095270e-06 * T2 +
         3.05731338e-10 * T3 - 2.03630460e-14 * T4 - 9.46834459e+03 * invT) *
        0.0623324814560868;
    // species 13: HCO
    result +=
        y[13] *
        (+1.77217438e+00 + 2.47847763e-03 * T - 8.28152043e-07 * T2 +
         1.47290445e-10 * T3 - 1.06701742e-14 * T4 + 4.01191815e+03 * invT) *
        0.0344613688055690;
    // species 14: CH2O
    result +=
        y[14] *
        (+7.60690080e-01 + 4.60000041e-03 * T - 1.47419604e-06 * T2 +
         2.51603030e-10 * T3 - 1.76771128e-14 * T4 - 1.39958323e+04 * invT) *
        0.0333044694598015;
    // species 15: CH3O
    result +=
        y[15] *
        (+3.75779238e+00 + 3.72071237e-03 * T - 8.99017253e-07 * T2 +
         1.09522626e-10 * T3 - 5.27074196e-15 * T4 + 3.78111940e+02 * invT) *
        0.0322227234645872;
    // species 16: CO
    result +=
        y[16] *
        (+1.71518561e+00 + 1.03126372e-03 * T - 3.32941924e-07 * T2 +
         5.75132520e-11 * T3 - 4.07295432e-15 * T4 - 1.41518724e+04 * invT) *
        0.0357015351660121;
    // species 17: CO2
    result +=
        y[17] *
        (+2.85746029e+00 + 2.20718513e-03 * T - 7.38271347e-07 * T2 +
         1.30872547e-10 * T3 - 9.44168328e-15 * T4 - 4.87591660e+04 * invT) *
        0.0227226249176305;
    // species 18: C2H2
    result +=
        y[18] *
        (+3.14756964e+00 + 2.98083332e-03 * T - 7.90982840e-07 * T2 +
         1.16853043e-10 * T3 - 7.22470426e-15 * T4 + 2.59359992e+04 * invT) *
        0.0384054074813734;
    // species 19: C2H3
    result +=
        y[19] *
        (+2.01672400e+00 + 5.16511460e-03 * T - 1.56027450e-06 * T2 +
         2.54408220e-10 * T3 - 1.72521408e-14 * T4 + 3.46128739e+04 * invT) *
        0.0369740442209569;
    // species 20: C2H4
    result +=
        y[20] *
        (+1.03611116e+00 + 7.32270755e-03 * T - 2.23692638e-06 * T2 +
         3.68057308e-10 * T3 - 2.51412122e-14 * T4 + 4.93988614e+03 * invT) *
        0.0356455407428531;
    // species 21: C2H5
    result +=
        y[21] *
        (+9.54656420e-01 + 8.69863610e-03 * T - 2.66068889e-06 * T2 +
         4.38044223e-10 * T3 - 2.99283152e-14 * T4 + 1.28575200e+04 * invT) *
        0.0344091941366733;
    // species 22: C2H6
    result +=
        y[22] *
        (+7.18815000e-02 + 1.08426339e-02 * T - 3.34186890e-06 * T2 +
         5.53530003e-10 * T3 - 3.80005780e-14 * T4 - 1.14263932e+04 * invT) *
        0.0332557366145660;
    // species 23: CH2CHO
    result +=
        y[23] *
        (+4.97566990e+00 + 4.06529570e-03 * T - 9.14541500e-07 * T2 +
         1.01757603e-10 * T3 - 4.35203420e-15 * T4 - 9.69500000e+02 * invT) *
        0.0232315019165989;
    // species 24: aC3H5
    result +=
        y[24] *
        (+5.50078770e+00 + 7.16236550e-03 * T - 1.89272107e-06 * T2 +
         2.77020025e-10 * T3 - 1.80727774e-14 * T4 + 1.74824490e+04 * invT) *
        0.0243468945535997;
    // species 25: C3H6
    result +=
        y[25] *
        (+5.73225700e+00 + 7.45417000e-03 * T - 1.64996633e-06 * T2 +
         1.80300550e-10 * T3 - 7.53240800e-15 * T4 - 9.23570300e+02 * invT) *
        0.0237636938285687;
    // species 26: nC3H7
    result +=
        y[26] *
        (+6.70974790e+00 + 8.01574250e-03 * T - 1.75734127e-06 * T2 +
         1.89720880e-10 * T3 - 7.77254380e-15 * T4 + 7.97622360e+03 * invT) *
        0.0232077792476038;
    // species 27: C2H3CHO
    result +=
        y[27] *
        (+4.81118680e+00 + 8.55712800e-03 * T - 2.49447203e-06 * T2 +
         3.56306225e-10 * T3 - 1.83493682e-14 * T4 - 1.07840540e+04 * invT) *
        0.0178367579908676;
    // species 28: C4H7
    result +=
        y[28] *
        (+6.01348350e+00 + 1.13172790e-02 * T - 3.08484900e-06 * T2 +
         4.20198175e-10 * T3 - 2.08172340e-14 * T4 + 2.09550080e+04 * invT) *
        0.0181488203266788;
    // species 29: C4H81
    result +=
        y[29] *
        (+1.05358410e+00 + 1.71752535e-02 * T - 5.29439900e-06 * T2 +
         8.27241550e-10 * T3 - 5.07220900e-14 * T4 - 2.13972310e+03 * invT) *
        0.0178227703714265;
    // species 30: pC4H9
    result +=
        y[30] *
        (+7.68223950e+00 + 1.18455355e-02 * T - 2.53162883e-06 * T2 +
         1.66067840e-10 * T3 + 1.09690272e-14 * T4 + 4.96440580e+03 * invT) *
        0.0175082288675678;
    // species 31: C5H9
    result +=
        y[31] *
        (+9.13864000e+00 + 1.13570690e-02 * T - 2.59701543e-06 * T2 +
         2.96913050e-10 * T3 - 1.31864896e-14 * T4 - 1.72183590e+03 * invT) *
        0.0144661275623128;
    // species 48: C12H25O2
    result +=
        y[48] *
        (+2.74782000e+01 + 2.68769500e-02 * T - 5.60620000e-06 * T2 +
         6.28417500e-10 * T3 - 2.94416000e-14 * T4 - 3.74118000e+04 * invT) *
        0.0049669696518154;
    // species 49: C12OOH
    result +=
        y[49] *
        (+2.82019000e+01 + 2.57958500e-02 * T - 5.24423333e-06 * T2 +
         5.75765000e-10 * T3 - 2.65280000e-14 * T4 - 3.11192000e+04 * invT) *
        0.0049669696518154;
    // species 50: O2C12H24OOH
    result +=
        y[50] *
        (+3.40907000e+01 + 2.55295000e-02 * T - 5.14483333e-06 * T2 +
         5.61567500e-10 * T3 - 2.57802000e-14 * T4 - 5.12675000e+04 * invT) *
        0.0042858122471371;
    // species 51: OC12H23OOH
    result +=
        y[51] *
        (+2.26731000e+01 + 3.08196000e-02 * T - 6.99453333e-06 * T2 +
         8.32915000e-10 * T3 - 4.07180000e-14 * T4 - 7.18258000e+04 * invT) *
        0.0046227596950828;
    // species 52: N2
    result +=
        y[52] *
        (+1.92664000e+00 + 7.43988400e-04 * T - 1.89492000e-07 * T2 +
         2.52425950e-11 * T3 - 1.35067020e-15 * T4 - 9.22797700e+02 * invT) *
        0.0356964374955379;
  }

  // species with midpoint at T=1385 kelvin
  if (T < 1385) {
    // species 45: SXC12H25
    result +=
        y[45] *
        (-2.36787089e+00 + 6.86776740e-02 * T - 2.74692053e-05 * T2 +
         5.91053905e-09 * T3 - 4.94871864e-13 * T4 - 1.67660539e+04 * invT) *
        0.0059055583114828;
    // species 46: S3XC12H25
    result +=
        y[46] *
        (-2.36787089e+00 + 6.86776740e-02 * T - 2.74692053e-05 * T2 +
         5.91053905e-09 * T3 - 4.94871864e-13 * T4 - 1.67660539e+04 * invT) *
        0.0059055583114828;
  } else {
    // species 45: SXC12H25
    result +=
        y[45] *
        (+3.69688268e+01 + 2.69359732e-02 * T - 6.07237543e-06 * T2 +
         7.01936257e-10 * T3 - 3.24216840e-14 * T4 - 3.12144988e+04 * invT) *
        0.0059055583114828;
    // species 46: S3XC12H25
    result +=
        y[46] *
        (+3.69688268e+01 + 2.69359732e-02 * T - 6.07237543e-06 * T2 +
         7.01936257e-10 * T3 - 3.24216840e-14 * T4 - 3.12144988e+04 * invT) *
        0.0059055583114828;
  }

  // species with midpoint at T=1390 kelvin
  if (T < 1390) {
    // species 33: PXC5H11
    result +=
        y[33] *
        (-9.47561592e-01 + 2.80398479e-02 * T - 1.10515268e-05 * T2 +
         2.44383445e-09 * T3 - 2.28019320e-13 * T4 + 4.71611460e+03 * invT) *
        0.0140561966743039;
    // species 35: PXC6H13
    result +=
        y[35] *
        (-1.20487147e+00 + 3.41900636e-02 * T - 1.38149304e-05 * T2 +
         3.15389505e-09 * T3 - 3.06240116e-13 * T4 + 1.83280393e+03 * invT) *
        0.0117412234354820;
    // species 37: PXC7H15
    result +=
        y[37] *
        (-1.49957041e+00 + 4.04413234e-02 * T - 1.66844251e-05 * T2 +
         3.91373270e-09 * T3 - 3.93232454e-13 * T4 - 1.04590223e+03 * invT) *
        0.0100809500287307;
    // species 39: PXC8H17
    result +=
        y[39] *
        (-1.77275944e+00 + 4.66274853e-02 * T - 1.94815748e-05 * T2 +
         4.63925535e-09 * T3 - 4.74254966e-13 * T4 - 3.92689511e+03 * invT) *
        0.0088320497421041;
    // species 41: PXC9H19
    result +=
        y[41] *
        (-2.04387292e+00 + 5.28086415e-02 * T - 2.22733324e-05 * T2 +
         5.36215415e-09 * T3 - 5.54808550e-13 * T4 - 6.80818512e+03 * invT) *
        0.0078584844126962;
    // species 43: PXC10H21
    result +=
        y[43] *
        (-2.31358348e+00 + 5.89864065e-02 * T - 2.50614360e-05 * T2 +
         6.08327765e-09 * T3 - 6.35045704e-13 * T4 - 9.68967550e+03 * invT) *
        0.0070782428969833;
    // species 44: PXC12H25
    result +=
        y[44] *
        (-2.85028741e+00 + 7.13353540e-02 * T - 3.06305518e-05 * T2 +
         7.52208480e-09 * T3 - 7.94908600e-13 * T4 - 1.54530435e+04 * invT) *
        0.0059055583114828;
  } else {
    // species 33: PXC5H11
    result +=
        y[33] *
        (+1.42977446e+01 + 1.19867655e-02 * T - 2.72797649e-06 * T2 +
         3.17207690e-10 * T3 - 1.47081811e-14 * T4 - 9.80712307e+02 * invT) *
        0.0140561966743039;
    // species 35: PXC6H13
    result +=
        y[35] *
        (+1.75385470e+01 + 1.41553981e-02 * T - 3.21769082e-06 * T2 +
         3.73868963e-10 * T3 - 1.73267213e-14 * T4 - 5.09299041e+03 * invT) *
        0.0117412234354820;
    // species 37: PXC7H15
    result +=
        y[37] *
        (+2.07940709e+01 + 1.63140122e-02 * T - 3.70460813e-06 * T2 +
         4.30167870e-10 * T3 - 1.99273400e-14 * T4 - 9.20938221e+03 * invT) *
        0.0100809500287307;
    // species 39: PXC8H17
    result +=
        y[39] *
        (+2.40510356e+01 + 1.84740081e-02 * T - 4.19217547e-06 * T2 +
         4.86571022e-10 * T3 - 2.25337796e-14 * T4 - 1.33300535e+04 * invT) *
        0.0088320497421041;
    // species 41: PXC9H19
    result +=
        y[41] *
        (+2.73097514e+01 + 2.06328672e-02 * T - 4.67944297e-06 * T2 +
         5.42937177e-10 * T3 - 2.51384614e-14 * T4 - 1.74516030e+04 * invT) *
        0.0078584844126962;
    // species 43: PXC10H21
    result +=
        y[43] *
        (+3.05697160e+01 + 2.27909202e-02 * T - 5.16649883e-06 * T2 +
         5.99277332e-10 * T3 - 2.77419118e-14 * T4 - 2.15737832e+04 * invT) *
        0.0070782428969833;
    // species 44: PXC12H25
    result +=
        y[44] *
        (+3.70921885e+01 + 2.71053924e-02 * T - 6.14018390e-06 * T2 +
         7.11905433e-10 * T3 - 3.29463496e-14 * T4 - 2.98194375e+04 * invT) *
        0.0059055583114828;
  }

  // species with midpoint at T=1391 kelvin
  if (T < 1391) {
    // species 0: NC12H26
    result +=
        y[0] *
        (-3.62181594e+00 + 7.36188555e-02 * T - 3.14656757e-05 * T2 +
         7.68603170e-09 * T3 - 8.07204460e-13 * T4 - 4.00654253e+04 * invT) *
        0.0058706117177410;
    // species 47: C12H24
    result +=
        y[47] *
        (-3.96342681e+00 + 7.19961800e-02 * T - 3.20461338e-05 * T2 +
         8.25436183e-09 * T3 - 9.24796380e-13 * T4 - 2.46345299e+04 * invT) *
        0.0059409234571422;
  } else {
    // species 0: NC12H26
    result +=
        y[0] *
        (+3.75095037e+01 + 2.81775024e-02 * T - 6.38310667e-06 * T2 +
         7.40062155e-10 * T3 - 3.42488300e-14 * T4 - 5.48843465e+04 * invT) *
        0.0058706117177410;
    // species 47: C12H24
    result +=
        y[47] *
        (+3.64002111e+01 + 2.63115377e-02 * T - 5.95414397e-06 * T2 +
         6.89874658e-10 * T3 - 3.19124998e-14 * T4 - 3.89405962e+04 * invT) *
        0.0059409234571422;
  }

  // species with midpoint at T=1392 kelvin
  if (T < 1392) {
    // species 32: C5H10
    result +=
        y[32] *
        (-2.06223481e+00 + 2.87109147e-02 * T - 1.24828963e-05 * T2 +
         3.18412472e-09 * T3 - 3.59219578e-13 * T4 - 4.46546666e+03 * invT) *
        0.0142582162971412;
    // species 34: C6H12
    result +=
        y[34] *
        (-2.35275205e+00 + 3.49327713e-02 * T - 1.53136007e-05 * T2 +
         3.92418358e-09 * T3 - 4.42592350e-13 * T4 - 7.34368617e+03 * invT) *
        0.0118818469142844;
    // species 36: C7H14
    result +=
        y[36] *
        (-2.67720549e+00 + 4.12305800e-02 * T - 1.82168036e-05 * T2 +
         4.69655757e-09 * T3 - 5.31475966e-13 * T4 - 1.02168601e+04 * invT) *
        0.0101844402122437;
    // species 38: C8H16
    result +=
        y[38] *
        (-2.89226915e+00 + 4.73033178e-02 * T - 2.09128507e-05 * T2 +
         5.37895772e-09 * T3 - 6.05437366e-13 * T4 - 1.31074559e+04 * invT) *
        0.0089113851857133;
    // species 40: C9H18
    result +=
        y[40] *
        (-3.16108263e+00 + 5.34791485e-02 * T - 2.36991081e-05 * T2 +
         6.09927692e-09 * T3 - 6.85543094e-13 * T4 - 1.59890847e+04 * invT) *
        0.0079212312761896;
    // species 42: C10H20
    result +=
        y[42] *
        (-3.42901688e+00 + 5.96527990e-02 * T - 2.64829675e-05 * T2 +
         6.81841490e-09 * T3 - 7.65436746e-13 * T4 - 1.88708365e+04 * invT) *
        0.0071291081485706;
  } else {
    // species 32: C5H10
    result +=
        y[32] *
        (+1.35851539e+01 + 1.12036235e-02 * T - 2.54449342e-06 * T2 +
         2.95472415e-10 * T3 - 1.36877028e-14 * T4 - 1.00898205e+04 * invT) *
        0.0142582162971412;
    // species 34: C6H12
    result +=
        y[34] *
        (+1.68337529e+01 + 1.33688829e-02 * T - 3.03345591e-06 * T2 +
         3.52049420e-10 * T3 - 1.63024849e-14 * T4 - 1.42062860e+04 * invT) *
        0.0118818469142844;
    // species 36: C7H14
    result +=
        y[36] *
        (+2.00898039e+01 + 1.55303939e-02 * T - 3.52149310e-06 * T2 +
         4.08514450e-10 * T3 - 1.89119644e-14 * T4 - 1.83260065e+04 * invT) *
        0.0101844402122437;
    // species 38: C8H16
    result +=
        y[38] *
        (+2.33540125e+01 + 1.76833231e-02 * T - 4.00694627e-06 * T2 +
         4.64637633e-10 * T3 - 2.15044524e-14 * T4 - 2.24485674e+04 * invT) *
        0.0089113851857133;
    // species 40: C9H18
    result +=
        y[40] *
        (+2.66142176e+01 + 1.98412643e-02 * T - 4.49398153e-06 * T2 +
         5.20976130e-10 * T3 - 2.41078588e-14 * T4 - 2.65709061e+04 * invT) *
        0.0079212312761896;
    // species 42: C10H20
    result +=
        y[42] *
        (+2.98753903e+01 + 2.19985763e-02 * T - 4.98085100e-06 * T2 +
         5.77294195e-10 * T3 - 2.67102954e-14 * T4 - 3.06937307e+04 * invT) *
        0.0071291081485706;
  }

  const double RT = 8.31446261815324e+07 * T; // R*T
  ubms = result * RT;
}

// intermediate function to spawn CKUBMS for every thread
__global__ GET_T_GIVEN_HY(const double *temp, const double *y) {

  double enthalpy = 0.0;

  for (int i = 0; i < maxiter; i++) {
    // assume the mass fraction is same for all cells since that does not affect
    // CKUBMS
    CKUBMS(temp[threadIdx.x], massfrac, enthalpy);
  }
}

// host wrapper
int main() {

  double *temp_h =
      new double[NUM_CELLS]; // allocate space for temperature in host memory
  double *massfrac_h =
      new float[NUM_SPECIES]; // allocate space for mass fraction in host memory

  // create random arrays
  default_random_engine re;
  uniform_real_distribution<double> unif_temp(T_MIN, T_MAX);
  for (int i = 0; i < NUM_CELLS; i++) {
    temp_h[i] = unif_temp(re);
  }
  uniform_real_distribution<double> unif_massfrac(MASSFRAC_MIN, MASSFRAC_MAX);
  for (int i = 0; i < NUM_CELLS; i++) {
    massfrac_h[i] = unif_massfrac(re);
  }

  double *temp_d, *massfrac_d;
  cudaMalloc(&temp_d,
             NUM_CELLS * sizeof(double)); // allocate device space for temp
  cudaMalloc(&massfrac_d,
             NUM_SPECIES *
                 sizeof(double)); // allocate device space for massfrac
  cudaCheckErrors("cudaMalloc failure");

  cudaMemcpy(temp_d, temp_h, NUM_CELLS * sizeof(double),
             cudaMemcpyHostToDevice);
  cudaMemcpy(massfrac_d, massfrac_h, NUM_SPECIES * sizeof(double),
             cudaMemcpyHostToDevice);
  cudaCheckErrors("cudaMemcpy HostToDevice failure");

  GET_T_GIVEN_HY<<<(NUM_CELLS + BLOCK_SIZE - 1) / BLOCK_SIZE, BLOCK_SIZE>>>(
      temp_d, massfrac_d);
  cudaDeviceSynchronize();
  cudaCheckErrors("CKUBMS kernel execution failure");

  return 0;
}
